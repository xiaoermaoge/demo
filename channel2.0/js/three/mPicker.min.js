function __dealCssEvent(a,f){var c=a,b,d=this;function e(g){if(g.target!==this){return}f.call(this,g);for(b=0;b<c.length;b++){d.off(c[b],e)}}if(f){for(b=0;b<c.length;b++){d.on(c[b],e)}}}$.fn.animationEnd=function(a){__dealCssEvent.call(this,["webkitAnimationEnd","animationend"],a);return this};$.fn.transitionEnd=function(a){__dealCssEvent.call(this,["webkitTransitionEnd","transitionend"],a);return this};$(function(){var r={display:"bottom",shadow:false,level:1,rows:4,Linkage:false,dataJson:"",height:36,idDefault:false,splitStr:" ",isshort:false,header:'<div class="mPicker-header"></div>',footer:'<div class="mPicker-footer"><a href="javascript:;" class="mPicker-confirm">确定</a><a href="javascript:;" class="mPicker-cancel">取消</a></div>',confirm:function(){},cancel:function(){}};var h;var i=["100%","50%"];var j=$("body");var w=$('<div class="mPicker-mask hide"></div>');var c=$('<div class="mPicker hide"></div>');var u,k;if(!$(".mPicker").length){j.append(c);c.append(w)}j.on("touchmove",function(x){if(u){x.preventDefault();x.stopPropagation()}});j.on({touchstart:function(x){x.preventDefault();u=1},touchmove:function(x){x.preventDefault();clearTimeout(k);k=setTimeout(function(){u=0},100)},touchend:function(x){x.preventDefault();u=0}},".mPicker-main");function v(y,x){if(!y.length){return false}this.container=y;this.mpicker=$(".mPicker");this.mask=this.mpicker.find(".mPicker-mask");this.options=$.extend({},r,x);this.init();this.event();this.container.data("mPicker",this)}v.prototype={init:function(y,x){this.middleRowIndex=parseInt(this.options.rows/2.5);this.disy=this.options.display==="bottom"?"mPicker-bottom down":"mPicker-modal";this.container.attr("readonly",true)},render:function(){var A;var D=[];var G;var H=this;D.push(H.options.dataJson);if(H.options.level>=2){var x=H.options.dataJson;for(var y=2;y<=H.options.level;y++){x=e(x[0]);D.push(x)}}A=q.call(H,D);G='<div class="mPicker-main '+H.disy+'" data-pickerId="'+H.pickerId+'">'+H.options.header+'<div class="mPicker-content">'+A+'</div><div class="mPicker-shadow"></div>'+H.options.footer+"</div>";H.mpicker.append(G);H.mpickerMain=H.mpicker.find(".mPicker-main");var z=H.mpickerMain.find(".mPicker-content");var B=H.mpickerMain.find(".mPicker-list");var C=B.find("ul");H.options.level>1?B.width((100/H.options.level).toFixed(2)+"%"):false;B.append('<div class="mPicker-active-box"></div>');B.find(".mPicker-active-box").height(H.options.height);var F=H.options.rows%2===0?-H.options.height-2+"px":-H.options.height*0.5-2+"px";z.find(".mPicker-active-box").css({"margin-top":F});var E=H.options.height*H.options.rows;z.height(E);B.height(E);B.find("ul").css({"min-height":E+"px"})},showPicker:function(){var x=this;x.render();var y=x.mpicker.find(".mPicker-list");x.container.focus();x.container.blur();x.mpicker.removeClass("hide");x.mask.removeClass("hide");clearTimeout(x.timer);x.timer=setTimeout(function(){x.mpickerMain.removeClass("down")},10);if(!x.noFirst&&x.options.idDefault){p.call(x)}var z=[];m(x.container,0);y.each(function(B,C){var A=x.container.data("id"+(B+1))?x.container.data("id"+(B+1)):0;z.push(A)});f.call(x,z)},hidePicker:function(y){var x=this;x.mask.addClass("hide");if(x.options.display==="bottom"){x.mpicker.find(".mPicker-main").addClass("down").transitionEnd(function(){x.mpicker.addClass("hide");x.mpicker.find(".mPicker-main").remove();if(typeof(y)==="function"){var B=[];var z=[];var A=x.container.val();for(var C=1;C<=x.options.level;C++){B.push(x.container.data("id"+C));z.push(x.container.data("value"+C))}B=B.join(x.options.splitStr);z=z.join(x.options.splitStr);y.call(x,{values:z,ids:B,name:A})}});return false}x.mpicker.addClass("hide");y.call(x);x.mpicker.find(".mPicker-main").remove()},updateData:function(z){var x=this;if(!z.length){return}x.noFirst=false;for(var y=0;y<x.options.level;y++){x.container.data("id"+(y+1),0);x.container.data("value"+(y+1),"")}x.options.dataJson=z;x.container.val("");x.mpicker.find(".mPicker-main").remove()},confirm:function(){var x=this;var z="";var y=x.mpicker.find(".mPicker-main").find(".mPicker-list");var A=y.find("ul");x.noFirst=true;$.each(A,function(C,E){var B=$(E).find(".active");var D=C===0?"":x.options.splitStr;if(B.length>0){C=C+1;x.container.data("value"+C,B.data("value"));x.container.data("id"+C,B.data("id"));z+=D+B.text()}});x.container.val(z);x.hidePicker(x.options.confirm)},cancel:function(){var x=this;x.hidePicker(x.options.cancel)},event:function(){var z=this;this.container.off("touchstart.container click.container").on("touchstart.container click.container",function(C){C.preventDefault();C.stopPropagation();var B=$(this);$(".mPicker").data("object",B.data("mPicker"));z.showPicker()});this.mpicker.off("touchstart.confirm click.confirm").on("touchstart.confirm click.confirm",".mPicker-confirm",function(C){C.preventDefault();var B=$(".mPicker").data("object");B.confirm()});this.mpicker.off("touchstart.cancel click.cancel").on("touchstart.cancel click.cancel",".mPicker-cancel",function(C){C.preventDefault();var B=$(".mPicker").data("object");B.cancel()});this.mpicker.off("touchstart.mask click.mask").on("touchstart.mask click.mask",".mPicker-mask",function(C){C.preventDefault();var B=$(".mPicker").data("object");if(B.options.shadow){B.cancel()}});var y;var x;var A;this.mpicker.off("touchstart.list mousedown.list").on("touchstart.list mousedown.list",".mPicker-list",function(B){g(B);var D=$(this).find("ul");var C=a(D);y=n(B).y-C;o(0,D);h=true});this.mpicker.off("touchmove.list mousemove.list").on("touchmove.list mousemove.list",".mPicker-list",function(F){F.preventDefault();if(!h){return false}var C=$(".mPicker").data("object");g(F);var H;var G=$(this).find("ul");var D=G.height();var I=C.options.height*C.options.rows;var B=I-D-parseInt(C.options.rows/2)*C.options.height;var E=C.middleRowIndex*C.options.height;x=n(F).y;A=x-y;H=Math.round(A);H=H>E?E:H;H=H<B?B:H;m(G,H);clearTimeout(C.timeTouchend);C.timeTouchend=setTimeout(function(){d.call(C,G)},100)});this.mpicker.off("touchend.list mouseup.list").on("touchend.list mouseup.list",".mPicker-list",function(C){C.preventDefault();var B=$(".mPicker").data("object");var D=$(this).find("ul");d.call(B,D)})}};function n(x){if(x.touches!==undefined){return{x:x.touches[0].pageX,y:x.touches[0].pageY}}if(x.touches===undefined){if(x.pageX!==undefined){return{x:x.pageX,y:x.pageY}}if(x.pageX===undefined){return{x:x.clientX,y:x.clientY}}}}function d(F){clearTimeout(this.timeTouchend);var G=b.call(this,F);var B=G.target.data("id");var E=this.mpicker.find(".mPicker-list ul");var x=E.index(F);var A=E.length;if(this.options.Linkage&&x<(A-1)){var D=this.options.dataJson[l(E,0)];var C;for(var z=2;z<=A;z++){var y=e(D);if(z>x+1){C=t.call(this,y);E.eq(z-1).html(C);b.call(this,E.eq(z-1),0);D=y[0]}else{D=y[l(E,z-1)]}}}o(400,F);h=false}function l(x,y){return x.eq(y).find("li.active").data("id")}function p(){var F=this;var x=this.container.val().split(this.options.splitStr);var y=[];var B=[];var D;var E;var A=function(H,G){$.each(H,function(I,J){if(J.name==x[G]){y[G]=I;B[G]=J.value;F.container.data("value"+(G+1),B[G]);F.container.data("id"+(G+1),y[G]);return false}})};if(typeof(x)!=="object"||!x.length||!F.mpicker.find(".mPicker-main")){return}A(this.options.dataJson,0);var C=this.options.dataJson;if(this.options.Linkage){for(var z=2;z<=this.options.level;z++){if(y[z-2]){C=e(C[y[z-2]]);A(C,z-1)}}return}for(var z=2;z<=this.options.level;z++){A(C[z-1],z-1)}}function b(B,C){var x;var D=Math.round((a(B)/this.options.height));var z=typeof(C)==="number"?B.find("li").index(B.find('li[data-id="'+C+'"]')):this.middleRowIndex-D;var A=-this.options.height*(z-this.middleRowIndex);m(B,A);B.find("li").eq(z).addClass("active").siblings("li").removeClass("active");x={target:B.find("li").eq(z),index:z};return x}function f(z){var y=this.mpicker.find(".mPicker-list ul");var x=this.options.dataJson[z[0]];b.call(this,y.eq(0),z[0]);if(this.options.Linkage){for(var A=1;A<z.length;A++){var B=z[A]||0;x=s.call(this,y,A,B,x)}return}for(var A=1;A<z.length;A++){var B=z[A]||0;b.call(this,y.eq(A),B)}}function s(y,z,C,x){var A=e(x);var B=t.call(this,A);y.eq(z).html(B);b.call(this,y.eq(z),C);return A[C]}function e(y){if(!y){return[]}var x=({}).hasOwnProperty.call(y,"child")?y.child:[];return x}function t(y){var z="";var x=this;$.each(y,function(B,D){var A=x.options.isshort?D.shortName:D.name;var C=D.value||D.name;z+='<li data-value="'+C+'" data-id="'+B+'">'+A+"</li>"});return z}function q(A){var z="";for(var y=0;y<A.length;y++){var x=t.call(this,A[y]);z+='<div class="mPicker-list"><ul>'+x+"</ul></div>"}return z}function o(y,x){x.css({"-webkit-transition-duration":y+"ms","transition-duration":y+"ms"})}function g(x){if(!x.touches){x.touches=x.originalEvent.touches}}function m(x,z){x.css({"-webkit-transform":"translateY("+z+"px)",transform:"translateY("+z+"px)"})}function a(z){var y=/\.*translateY\((.*)px\)/i;var x;if(z[0].style.WebkitTransform){x=parseInt(y.exec(z[0].style.WebkitTransform)[1])}else{if(z[0].style.transform){x=parseInt(y.exec(z[0].style.transforms)[1])}}return x}$.fn.mPicker=function(x){return this.each(function(){new v($(this),x)})}}());